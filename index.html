<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Very Very Safe Link</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
  :root {
    --yellow: #f9df6d;
    --green: #a0c35a;
    --blue: #b0c4ef;
    --purple: #ba81c5;
    --bg: #faf7f2;
    --card-bg: #efebe4;
    --text: #1a1a1a;
    --text-light: #5a5a5a;
    --selected: #1a1a1a;
    --selected-text: #fff;
    --error-shake: shake 0.4s ease-in-out;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'DM Sans', sans-serif;
    background: var(--bg);
    color: var(--text);
    min-height: 100dvh;
    display: flex;
    flex-direction: column;
    align-items: center;
    overflow-x: hidden;
  }

  .container {
    width: 100%;
    max-width: 640px;
    padding: 24px 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  h1 {
    font-family: 'DM Serif Display', serif;
    font-size: 2rem;
    margin-bottom: 4px;
    letter-spacing: -0.5px;
  }

  .subtitle {
    color: var(--text-light);
    font-size: 0.95rem;
    margin-bottom: 24px;
  }

  .solved-area {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 8px;
  }

  .solved-group {
    border-radius: 12px;
    padding: 16px;
    text-align: center;
    animation: solvedIn 0.5s cubic-bezier(.34,1.56,.64,1) forwards;
    opacity: 0;
    transform: scale(0.9);
  }
  @keyframes solvedIn { to { opacity: 1; transform: scale(1); } }

  .solved-group .group-name {
    font-weight: 700;
    font-size: 0.85rem;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin-bottom: 4px;
  }
  .solved-group .group-words { font-size: 0.95rem; font-weight: 500; }

  .solved-group.yellow { background: var(--yellow); }
  .solved-group.green  { background: var(--green); }
  .solved-group.blue   { background: var(--blue); }
  .solved-group.purple { background: var(--purple); }

  .grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 8px;
    width: 100%;
    margin-bottom: 20px;
  }

  .tile {
    aspect-ratio: 2.2 / 1;
    border-radius: 10px;
    background: var(--card-bg);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: clamp(0.62rem, 2.4vw, 0.85rem);
    text-transform: uppercase;
    letter-spacing: 0.3px;
    cursor: pointer;
    user-select: none;
    transition: background 0.15s, color 0.15s, transform 0.15s;
    text-align: center;
    padding: 4px 5px;
    line-height: 1.2;
    -webkit-tap-highlight-color: transparent;
  }

  .tile:hover { transform: scale(1.04); }
  .tile.selected {
    background: var(--selected);
    color: var(--selected-text);
    transform: scale(1.04);
  }
  .tile.wrong { animation: var(--error-shake); }

  @keyframes shake {
    0%, 100% { transform: translateX(0); }
    20% { transform: translateX(-6px); }
    40% { transform: translateX(6px); }
    60% { transform: translateX(-4px); }
    80% { transform: translateX(4px); }
  }

  .controls {
    display: flex;
    gap: 10px;
    margin-bottom: 16px;
  }

  button {
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 0.95rem;
    padding: 12px 28px;
    border-radius: 999px;
    cursor: pointer;
    transition: all 0.15s;
    border: 2px solid var(--text);
    background: transparent;
    color: var(--text);
  }
  button:hover { background: var(--text); color: #fff; }
  button:disabled { opacity: 0.35; cursor: not-allowed; }
  button:disabled:hover { background: transparent; color: var(--text); }
  button.primary { background: var(--text); color: #fff; }
  button.primary:hover { background: #333; }
  button.primary:disabled:hover { background: var(--text); color: #fff; }

  .mistakes {
    display: flex;
    align-items: center;
    gap: 6px;
    font-size: 0.9rem;
    color: var(--text-light);
    margin-bottom: 20px;
  }
  .dot {
    width: 12px; height: 12px;
    border-radius: 50%;
    background: var(--text);
    transition: opacity 0.3s;
  }
  .dot.used { opacity: 0.15; }

  /* Valentine Overlay */
  .valentine-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    pointer-events: none;
    transition: background 0.6s;
  }
  .valentine-overlay.active {
    background: rgba(0,0,0,0.55);
    pointer-events: all;
  }

  .valentine-card {
    background: #fff;
    border-radius: 24px;
    padding: 40px 32px;
    max-width: 420px;
    width: 90%;
    text-align: center;
    transform: scale(0.8) translateY(30px);
    opacity: 0;
    transition: all 0.6s cubic-bezier(.34,1.56,.64,1);
    box-shadow: 0 24px 80px rgba(0,0,0,0.25);
    position: relative;
    overflow: hidden;
  }
  .valentine-overlay.active .valentine-card {
    transform: scale(1) translateY(0);
    opacity: 1;
  }

  .valentine-card::before {
    content: '';
    position: absolute;
    top: -60px; left: -60px;
    width: 180px; height: 180px;
    border-radius: 50%;
    background: var(--yellow);
    opacity: 0.25;
    z-index: 0;
  }
  .valentine-card::after {
    content: '';
    position: absolute;
    bottom: -40px; right: -40px;
    width: 140px; height: 140px;
    border-radius: 50%;
    background: var(--purple);
    opacity: 0.2;
    z-index: 0;
  }

  .valentine-card .yay-text {
    font-family: 'DM Serif Display', serif;
    font-size: 2.8rem;
    margin-bottom: 10px;
    position: relative;
    z-index: 1;
    animation: yayBounce 0.6s cubic-bezier(.34,1.56,.64,1) forwards;
  }
  @keyframes yayBounce {
    0% { transform: scale(0); opacity: 0; }
    60% { transform: scale(1.2); }
    100% { transform: scale(1); opacity: 1; }
  }

  .valentine-card .lebron-gif {
    width: 220px;
    max-width: 80%;
    border-radius: 14px;
    margin-bottom: 14px;
    position: relative;
    z-index: 1;
    animation: gifIn 0.5s 0.2s cubic-bezier(.34,1.56,.64,1) both;
  }
  @keyframes gifIn {
    0% { transform: scale(0) rotate(-8deg); opacity: 0; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
  }

  .valentine-card h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.65rem;
    margin-bottom: 24px;
    position: relative;
    z-index: 1;
    animation: fadeUp 0.5s 0.4s ease both;
  }

  @keyframes fadeUp {
    from { opacity: 0; transform: translateY(12px); }
    to { opacity: 1; transform: translateY(0); }
  }

  .answer-buttons {
    display: flex;
    gap: 16px;
    justify-content: center;
    position: relative;
    z-index: 1;
    animation: fadeUp 0.5s 0.5s ease both;
    min-height: 60px;
    align-items: center;
  }

  .btn-yes {
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 1.15rem;
    padding: 14px 44px;
    border-radius: 999px;
    border: none;
    background: #e74c6f;
    color: #fff;
    cursor: pointer;
    transition: all 0.2s;
    box-shadow: 0 4px 16px rgba(231, 76, 111, 0.35);
  }
  .btn-yes:hover { background: #d63d60; transform: scale(1.06); box-shadow: 0 6px 24px rgba(231, 76, 111, 0.45); }

  .btn-no {
    font-family: 'DM Sans', sans-serif;
    font-weight: 600;
    font-size: 1rem;
    padding: 12px 32px;
    border-radius: 999px;
    border: 2px solid #ccc;
    background: #fff;
    color: #999;
    cursor: pointer;
    transition: all 0.3s cubic-bezier(.34,1.56,.64,1);
    position: relative;
  }

  /* GIF Explosion Overlay */
  .gif-explosion {
    position: fixed;
    inset: 0;
    background: #000;
    z-index: 500;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    overflow: auto;
    padding: 24px 16px;
  }
  .gif-explosion.active {
    display: flex;
  }

  .gif-explosion .big-text {
    font-family: 'DM Serif Display', serif;
    font-size: clamp(2.5rem, 8vw, 4.5rem);
    color: #fff;
    text-align: center;
    margin-bottom: 20px;
    animation: yayBounce 0.6s cubic-bezier(.34,1.56,.64,1) forwards;
    z-index: 2;
    text-shadow: 0 0 40px rgba(255, 75, 120, 0.6);
  }

  .gif-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    max-width: 700px;
    width: 92%;
    z-index: 2;
  }

  .gif-grid img {
    width: 100%;
    border-radius: 14px;
    animation: gifPop 0.4s cubic-bezier(.34,1.56,.64,1) both;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  }
  .gif-grid img:nth-child(1) { animation-delay: 0.1s; }
  .gif-grid img:nth-child(2) { animation-delay: 0.2s; }
  .gif-grid img:nth-child(3) { animation-delay: 0.3s; }
  .gif-grid img:nth-child(4) { animation-delay: 0.4s; }
  .gif-grid img:nth-child(5) { animation-delay: 0.5s; }

  @keyframes gifPop {
    0% { transform: scale(0) rotate(-10deg); opacity: 0; }
    100% { transform: scale(1) rotate(0deg); opacity: 1; }
  }

  /* Last row: 2 gifs centered */
  .gif-grid-bottom {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    max-width: 470px;
    width: 70%;
    margin-top: 10px;
    z-index: 2;
  }
  .gif-grid-bottom img {
    width: 100%;
    border-radius: 14px;
    animation: gifPop 0.4s cubic-bezier(.34,1.56,.64,1) both;
    box-shadow: 0 4px 20px rgba(0,0,0,0.5);
  }
  .gif-grid-bottom img:nth-child(1) { animation-delay: 0.6s; }
  .gif-grid-bottom img:nth-child(2) { animation-delay: 0.7s; }

  .gif-explosion .sign-off {
    color: rgba(255,255,255,0.8);
    font-size: 1.15rem;
    font-weight: 600;
    margin-top: 24px;
    z-index: 2;
    animation: fadeUp 0.5s 0.9s ease both;
  }

  /* Game Over Popup */
  .gameover-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 100;
    pointer-events: none;
    transition: background 0.6s;
  }
  .gameover-overlay.active {
    background: rgba(0,0,0,0.55);
    pointer-events: all;
  }
  .gameover-card {
    background: #fff;
    border-radius: 24px;
    padding: 44px 36px;
    max-width: 380px;
    width: 88%;
    text-align: center;
    transform: scale(0.8) translateY(30px);
    opacity: 0;
    transition: all 0.6s cubic-bezier(.34,1.56,.64,1);
    box-shadow: 0 24px 80px rgba(0,0,0,0.25);
  }
  .gameover-overlay.active .gameover-card {
    transform: scale(1) translateY(0);
    opacity: 1;
  }
  .gameover-card .gameover-emoji {
    font-size: 3rem;
    margin-bottom: 12px;
  }
  .gameover-card h2 {
    font-family: 'DM Serif Display', serif;
    font-size: 1.6rem;
    margin-bottom: 8px;
  }
  .gameover-card p {
    color: var(--text-light);
    font-size: 1rem;
    margin-bottom: 24px;
    line-height: 1.5;
  }
  .btn-restart {
    font-family: 'DM Sans', sans-serif;
    font-weight: 700;
    font-size: 1.05rem;
    padding: 14px 40px;
    border-radius: 999px;
    border: none;
    background: var(--text);
    color: #fff;
    cursor: pointer;
    transition: all 0.2s;
  }
  .btn-restart:hover { background: #333; transform: scale(1.05); }

  /* Toast */
  .toast {
    position: fixed;
    top: 24px;
    left: 50%;
    transform: translateX(-50%);
    background: #1a1a1a;
    color: #fff;
    padding: 10px 28px;
    border-radius: 999px;
    font-weight: 600;
    font-size: 0.92rem;
    z-index: 300;
    animation: toastIn 0.3s ease, toastOut 0.3s 1.5s ease forwards;
    white-space: nowrap;
  }
  @keyframes toastIn { from { opacity: 0; transform: translateX(-50%) translateY(-10px); } to { opacity: 1; transform: translateX(-50%) translateY(0); } }
  @keyframes toastOut { to { opacity: 0; transform: translateX(-50%) translateY(-10px); } }

  #confetti {
    position: fixed;
    inset: 0;
    pointer-events: none;
    z-index: 600;
  }

  @media (max-width: 400px) {
    .tile { font-size: 0.58rem; aspect-ratio: 2/1; }
    .container { padding: 16px 10px; }
    button { padding: 10px 20px; font-size: 0.85rem; }
    .valentine-card .yay-text { font-size: 2.2rem; }
    .valentine-card .lebron-gif { width: 170px; }
    .gif-grid { grid-template-columns: repeat(2, 1fr); gap: 8px; }
    .gif-grid-bottom { grid-template-columns: 1fr; max-width: 200px; width: 55%; }
  }
</style>
</head>
<body>

<div class="container">
  <h1>Connections</h1>
  <p class="subtitle">Create four groups of four!</p>

  <div class="solved-area" id="solvedArea"></div>
  <div class="grid" id="grid"></div>

  <div class="controls">
    <button id="shuffleBtn" onclick="shuffle()">Shuffle</button>
    <button id="deselectBtn" onclick="deselectAll()">Deselect</button>
    <button id="submitBtn" class="primary" onclick="submit()" disabled>Submit</button>
  </div>

  <div class="mistakes">
    <span>Mistakes remaining:</span>
    <span class="dot" id="d1"></span>
    <span class="dot" id="d2"></span>
    <span class="dot" id="d3"></span>
    <span class="dot" id="d4"></span>
  </div>
</div>

<!-- Valentine Question Popup -->
<div class="valentine-overlay" id="overlay">
  <div class="valentine-card">
    <div class="yay-text">YAYYY!! üéâ</div>
    <img class="lebron-gif" src="https://media0.giphy.com/media/v1.Y2lkPTc5MGI3NjExdDg4eHh0eTIzMXMwaGwwNXJhNTJ6anlrdzljb2x0eHVlOXRtNndnNiZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/D1ZArr6pCqsIlOZjme/giphy.gif" alt="LeBron celebration">
    <h2>Will You Be My Valentine? ‚ù§Ô∏è</h2>
    <div class="answer-buttons">
      <button class="btn-yes" onclick="sayYes()">Yes üíï</button>
      <button class="btn-no" id="noBtn" onmouseenter="runAway()" ontouchstart="runAway()">No</button>
    </div>
  </div>
</div>

<!-- GIF Explosion Screen (after Yes) -->
<div class="gif-explosion" id="gifExplosion">
  <div class="big-text">YESSS I LOVE YOU SO MUCH‚ù§Ô∏è‚ù§Ô∏è‚ù§Ô∏è</div>
  <div class="gif-grid">
    <img src="https://media4.giphy.com/media/v1.Y2lkPTc5MGI3NjExa3E1MWRiNTJvYWJ5emYxcW1xdHZ0ZjIwNmN2OTBzeWZuZGw5ZHh3aCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/INZUj2jZSruso/giphy.gif" alt="GIF 1">
    <img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExbTFsZmJhdzU2bHVnb25tY2RrcHpkZ3BkbjFiMnp2eXpwajlheTB0eCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/dW7qj1hS9swu1MnXOC/giphy.gif" alt="GIF 2">
    <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExcmVkYnFlYTZqdDZrd2Z5cnIyYmJpYTNzMjd1bmo3dmpmZ2g1dnliNCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/l2YWfJ8WCq1zWgFyw/giphy.gif" alt="GIF 3">
  </div>
  <div class="gif-grid-bottom">
    <img src="https://media1.giphy.com/media/v1.Y2lkPTc5MGI3NjExODQ5bGtobG5xODN6emNvZWNidHVwM2tvZTExZ3JpM3B1MXdhdjFreSZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/1qFwN4Su3tuCit6QUT/giphy.gif" alt="GIF 4">
    <img src="https://media2.giphy.com/media/v1.Y2lkPTc5MGI3NjExOXVrYmE1M2s5M2ZqbHBxOHI4YnN6aDF2azQyNGgyYmp0OHNtaHp5aCZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/bMJqfOtgVEyI2PLnaW/giphy.gif" alt="GIF 5">
  </div>
</div>

<!-- Game Over Popup -->
<div class="gameover-overlay" id="gameoverOverlay">
  <div class="gameover-card">
    <div class="gameover-emoji">üòø</div>
    <h2>Ruh Roh...</h2>
    <p>Try again!</p>
    <button class="btn-restart" onclick="restartGame()">Try Again</button>
  </div>
</div>

<canvas id="confetti"></canvas>

<script>
// =============================================================
//  üéØ  GAME CONFIGURATION
// =============================================================

const GROUPS = [
  {
    name: "Our Very First Date",
    color: "yellow",
    words: ["NE ZHA 2", "POPMART GIFT", "BLOCK BLAST", "SUMMER PROGRAM"],
    mustBeLast: false
  },
  {
    name: "Our Favorite Food Places",
    color: "green",
    words: ["MALATANG", "HEYTEA", "MOLLY TEA", "YOGURTLAND"],
    mustBeLast: false
  },
  {
    name: "Things I Love About You",
    color: "blue",
    words: ["SCENT", "SMILE", "KINDNESS", "HUMOR"],
    mustBeLast: false
  },
  {
    name: "Be My Valentine ‚ù§Ô∏è",
    color: "purple",
    words: ["WILL", "YOU", "BE", "MINE"],
    mustBeLast: true
  }
];

// =============================================================
//  RUNAWAY "NO" BUTTON
// =============================================================

let noRunCount = 0;

function runAway() {
  const btn = document.getElementById('noBtn');
  const card = btn.closest('.valentine-card');
  const cardRect = card.getBoundingClientRect();

  noRunCount++;

  if (noRunCount >= 4) {
    btn.style.transition = 'all 0.4s ease';
    btn.style.transform = 'scale(0)';
    btn.style.opacity = '0';
    setTimeout(() => { btn.style.display = 'none'; }, 400);
    return;
  }

  const maxX = cardRect.width / 2 - 60;
  const maxY = 80;
  const rx = (Math.random() - 0.5) * 2 * maxX;
  const ry = (Math.random() - 0.5) * 2 * maxY;
  const scale = 1 - (noRunCount * 0.15);
  btn.style.transform = `translate(${rx}px, ${ry}px) scale(${scale})`;
}

// =============================================================
//  YES ‚Üí GIF EXPLOSION
// =============================================================

function sayYes() {
  document.getElementById('overlay').style.display = 'none';
  document.getElementById('gifExplosion').classList.add('active');
  launchConfetti();
}

// =============================================================
//  GAME LOGIC
// =============================================================

let tiles = [];
let selected = [];
let solvedGroups = [];
let mistakesLeft = 4;
let guessedSets = [];

function init() {
  const allWords = [];
  GROUPS.forEach(g => g.words.forEach(w => allWords.push({ word: w, group: g })));
  tiles = allWords;
  shuffleArray(tiles);
  render();
}

function shuffleArray(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
}

function render() {
  const grid = document.getElementById('grid');
  grid.innerHTML = '';
  tiles.forEach((t, i) => {
    const div = document.createElement('div');
    div.className = 'tile' + (selected.includes(i) ? ' selected' : '');
    div.textContent = t.word;
    div.onclick = () => toggleSelect(i);
    grid.appendChild(div);
  });
  document.getElementById('submitBtn').disabled = selected.length !== 4;
}

function toggleSelect(i) {
  if (selected.includes(i)) {
    selected = selected.filter(x => x !== i);
  } else if (selected.length < 4) {
    selected.push(i);
  }
  render();
}

function deselectAll() { selected = []; render(); }

function shuffle() { selected = []; shuffleArray(tiles); render(); }

function showToast(msg) {
  document.querySelectorAll('.toast').forEach(t => t.remove());
  const toast = document.createElement('div');
  toast.className = 'toast';
  toast.textContent = msg;
  document.body.appendChild(toast);
  setTimeout(() => toast.remove(), 2000);
}

function submit() {
  if (selected.length !== 4) return;

  const words = selected.map(i => tiles[i].word).sort();
  const key = words.join(',');
  if (guessedSets.includes(key)) return;

  const group = tiles[selected[0]].group;
  const allSame = selected.every(i => tiles[i].group === group);

  if (allSame) {
    const unsolvedNonLast = GROUPS.filter(g => !solvedGroups.includes(g) && !g.mustBeLast);
    if (group.mustBeLast && unsolvedNonLast.length > 0) {
      showToast("Not yet... üòè");
      selected = [];
      render();
      return;
    }

    guessedSets.push(key);
    solvedGroups.push(group);

    const solvedArea = document.getElementById('solvedArea');
    const div = document.createElement('div');
    div.className = `solved-group ${group.color}`;
    div.innerHTML = `<div class="group-name">${group.name}</div><div class="group-words">${group.words.join(', ')}</div>`;
    solvedArea.appendChild(div);

    const remaining = [];
    tiles.forEach((t, i) => { if (!selected.includes(i)) remaining.push(t); });
    tiles = remaining;
    selected = [];
    render();

    if (solvedGroups.length === 4) {
      document.querySelector('.controls').style.display = 'none';
      document.querySelector('.mistakes').style.display = 'none';
      setTimeout(showValentine, 800);
    }
  } else {
    guessedSets.push(key);

    const groupCounts = {};
    selected.forEach(i => {
      const gn = tiles[i].group.name;
      groupCounts[gn] = (groupCounts[gn] || 0) + 1;
    });
    const maxMatch = Math.max(...Object.values(groupCounts));

    mistakesLeft--;
    updateMistakes();

    const gridEl = document.getElementById('grid');
    const tileEls = gridEl.querySelectorAll('.tile');
    selected.forEach(i => tileEls[i]?.classList.add('wrong'));
    setTimeout(() => { selected.forEach(i => tileEls[i]?.classList.remove('wrong')); }, 500);

    if (maxMatch === 3) showToast("One away!");

    selected = [];
    render();

    if (mistakesLeft <= 0) setTimeout(gameOver, 600);
  }
}

function updateMistakes() {
  for (let i = 1; i <= 4; i++) {
    const dot = document.getElementById('d' + i);
    if (i > mistakesLeft) dot.classList.add('used');
  }
}

function gameOver() {
  document.getElementById('grid').innerHTML = '';
  document.querySelector('.controls').style.display = 'none';
  document.querySelector('.mistakes').style.display = 'none';
  document.getElementById('gameoverOverlay').classList.add('active');
}

function restartGame() {
  // Reset all state
  document.getElementById('gameoverOverlay').classList.remove('active');
  document.getElementById('solvedArea').innerHTML = '';
  document.querySelector('.controls').style.display = 'flex';
  document.querySelector('.mistakes').style.display = 'flex';
  tiles = [];
  selected = [];
  solvedGroups = [];
  mistakesLeft = 4;
  guessedSets = [];
  for (let i = 1; i <= 4; i++) {
    document.getElementById('d' + i).classList.remove('used');
  }
  init();
}

function showValentine() {
  document.getElementById('overlay').classList.add('active');
}

// ---- Confetti ----
function launchConfetti() {
  const canvas = document.getElementById('confetti');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const colors = ['#f9df6d','#a0c35a','#b0c4ef','#ba81c5','#ff6b8a','#ff4d6d','#ff85a1','#ffd700'];
  const pieces = [];

  for (let i = 0; i < 200; i++) {
    pieces.push({
      x: Math.random() * canvas.width,
      y: Math.random() * canvas.height - canvas.height,
      w: Math.random() * 10 + 5,
      h: Math.random() * 6 + 3,
      color: colors[Math.floor(Math.random() * colors.length)],
      vy: Math.random() * 3 + 2,
      vx: (Math.random() - 0.5) * 2,
      rot: Math.random() * 360,
      rv: (Math.random() - 0.5) * 8,
    });
  }

  let frame = 0;
  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    pieces.forEach(p => {
      p.y += p.vy;
      p.x += p.vx;
      p.rot += p.rv;
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate((p.rot * Math.PI) / 180);
      ctx.fillStyle = p.color;
      ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
      ctx.restore();
    });
    frame++;
    if (frame < 400) requestAnimationFrame(draw);
    else ctx.clearRect(0, 0, canvas.width, canvas.height);
  }
  draw();
}

window.addEventListener('resize', () => {
  const canvas = document.getElementById('confetti');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});

init();
</script>
</body>
</html>
